---
title: "外部サービス連携"
updated: "2024-01-01T00:00:00Z"
owner: "TBD"
---

# 外部サービス連携

## 外部SaaS/API一覧

### メール送信サービス

- **サービス名**: TBD（例: SendGrid, AWS SES, Mailgun）
- **用途**: トランザクションメール（パスワードリセット、通知等）
- **認証方式**: API Key
- **レート制限**: TBD（例: 1日あたり10,000通）
- **リトライ方針**: 指数バックオフ、最大3回リトライ

### オブジェクトストレージ

- **サービス名**: TBD（例: AWS S3, Google Cloud Storage）
- **用途**: ファイル保存（プロフィール画像、エクスポートファイル等）
- **認証方式**: IAM Role / Service Account
- **レート制限**: TBD
- **リトライ方針**: 指数バックオフ、最大5回リトライ

### 監視・ログサービス

- **サービス名**: TBD（例: Datadog, New Relic, CloudWatch）
- **用途**: アプリケーションモニタリング、ログ集約
- **認証方式**: API Key
- **レート制限**: TBD
- **リトライ方針**: 非同期送信、失敗時はローカルバッファに保存

### CDN

- **サービス名**: TBD（例: Cloudflare, AWS CloudFront）
- **用途**: 静的コンテンツの配信
- **認証方式**: 設定ベース
- **レート制限**: TBD
- **リトライ方針**: CDN側で自動リトライ

## 認証方式

### API Key認証

- **適用サービス**: メール送信サービス、監視サービス
- **管理方法**: 環境変数またはシークレット管理サービス（AWS Secrets Manager等）
- **ローテーション**: 定期的にローテーション（例: 90日ごと）

### IAM Role / Service Account

- **適用サービス**: クラウドサービス（S3, CloudWatch等）
- **管理方法**: クラウドプロバイダーのIAM機能
- **ローテーション**: 自動ローテーション

## スロットリング/リトライ方針

### レート制限対応

- **実装**: クライアント側でレート制限を検知し、適切な待機時間を設ける
- **エラーハンドリング**: `429 Too Many Requests` エラー時に指数バックオフでリトライ

### リトライ戦略

- **指数バックオフ**: 初回1秒、2回目2秒、3回目4秒...
- **最大リトライ回数**: サービスごとに設定（例: メール送信3回、ファイルアップロード5回）
- **タイムアウト**: サービスごとに設定（例: メール送信10秒、ファイルアップロード60秒）

### フォールバック

- **メール送信**: プライマリサービス失敗時、セカンダリサービスに切り替え
- **ファイルストレージ**: プライマリリージョン失敗時、セカンダリリージョンに切り替え

## 依存関係管理

### サービス依存度

- **高依存**: メール送信サービス（ユーザー登録・認証に必須）
- **中依存**: オブジェクトストレージ（一部機能で使用）
- **低依存**: 監視サービス（運用に必要だが、サービス停止時も動作可能）

### 障害時の対応

- **高依存サービス障害**: サービス全体の機能制限またはメンテナンスモード
- **中依存サービス障害**: 該当機能を一時的に無効化
- **低依存サービス障害**: サービスは継続、モニタリングのみ影響

## 関連ドキュメント

- [アーキテクチャ概要](./architecture_overview.md)
- [エラーハンドリング](./error_handling.md)
- [パフォーマンスとスケーラビリティ](../2_NonFunctionalRequirements/performance_and_scalability.md)

## 追記履歴

| 日時 | 変更者 | 要旨 |
|------|--------|------|
| 2024-01-01 | TBD | 初版作成 |

## TODO

- [ ] 各外部サービスの選定・契約
- [ ] API認証情報の管理方法を確定
- [ ] リトライ・フォールバック戦略を実装
- [ ] 外部サービス依存度の評価
- [ ] 障害時の対応手順を文書化

