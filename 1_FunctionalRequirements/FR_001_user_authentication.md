---
title: "FR_001: ユーザー認証"
updated: "2024-01-01T00:00:00Z"
owner: "TBD"
---

# FR_001: ユーザー認証

## 目的

ユーザーがシステムに安全にログインし、セッションを管理する機能を提供する。

## 利用者

- エンドユーザー（登録済みユーザー）
- 新規ユーザー（未登録ユーザー）

## 前提・制約

- メールアドレスとパスワードによる認証を基本とする
- 二要素認証（2FA）は将来の拡張として検討
- セッション有効期限は30日間（「ログイン状態を保持する」チェック時）

## ユースケース

### メインフロー: ログイン

1. ユーザーがログイン画面にアクセス
2. メールアドレスとパスワードを入力
3. 「ログイン」ボタンをクリック
4. システムが認証情報を検証
5. 認証成功時、ダッシュボードにリダイレクト
6. 認証失敗時、エラーメッセージを表示

### 代替フロー: パスワードリセット

1. ユーザーが「パスワードを忘れた場合」リンクをクリック
2. メールアドレスを入力
3. リセットメールを送信
4. ユーザーがメール内のリンクをクリック
5. 新しいパスワードを設定
6. 新しいパスワードでログイン

### 例外フロー: アカウントロック

1. 連続して5回ログインに失敗
2. アカウントが30分間ロックされる
3. ロック解除メールを送信
4. ユーザーがメール内のリンクをクリックしてロック解除

## 入力/出力

### 入力項目

#### ログイン

- `email` (string, required): メールアドレス
- `password` (string, required): パスワード
- `remember_me` (boolean, optional): ログイン状態を保持するか

#### パスワードリセット

- `email` (string, required): メールアドレス

### 出力項目

#### ログイン成功時

- `access_token` (string): JWTアクセストークン
- `refresh_token` (string): リフレッシュトークン
- `user_id` (string): ユーザーID
- `expires_in` (number): トークン有効期限（秒）

#### エラー時

- `error_code` (string): エラーコード
- `error_message` (string): エラーメッセージ

## 受入条件（Acceptance Criteria）

- [ ] 有効なメールアドレスとパスワードでログインできる
- [ ] 無効な認証情報でログインを試みた場合、適切なエラーメッセージが表示される
- [ ] 連続5回のログイン失敗でアカウントがロックされる
- [ ] パスワードリセット機能が正常に動作する
- [ ] セッションが適切に管理され、期限切れ時に再ログインを促す
- [ ] ログアウト機能が正常に動作する

## 関連ドキュメント

- [セキュリティとプライバシー](../2_NonFunctionalRequirements/security_and_privacy.md)
- [API仕様](../3_SystemDesign/api_specifications.md)
- [エラーハンドリング](../3_SystemDesign/error_handling.md)
- [データモデル・ERD](../3_SystemDesign/data_model_ERD.md)

## 追記履歴

| 日時 | 変更者 | 要旨 |
|------|--------|------|
| 2024-01-01 | TBD | 初版作成 |

## TODO

- [ ] 二要素認証（2FA）の要件を検討
- [ ] ソーシャルログイン（Google, GitHub等）の要件を検討
- [ ] パスワード強度要件を定義
- [ ] セッション管理の詳細仕様を確定
- [ ] ログアウト機能の詳細を記載

